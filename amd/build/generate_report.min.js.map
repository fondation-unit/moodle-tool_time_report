{"version":3,"sources":["../src/generate_report.js"],"names":["define","$","Ajax","Notification","Str","Url","GenerateReport","requestorId","userId","userName","contextId","parseInt","start","end","timer","file","formdata","polling","click","e","preventDefault","startDate","val","endDate","console","log","completion","checkCompletion","icon","attr","imageUrl","alert","get_string","requestorid","userid","username","contextid","call","methodname","args","jsonformdata","JSON","stringify","done","str","addClass","html","prepend","that","setInterval","pollFile","bind","fail","exception","prototype","length","dlicon","data","status","content","path","removeClass","clearInterval","generateReport"],"mappings":"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","sourcesContent":["define(['jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/url'], function ($, Ajax, Notification, Str, Url) {\n        'use strict';\n\n        var GenerateReport = function (requestorId, userId, userName, contextId) {\n            this.requestorId = parseInt(requestorId);\n            this.userId = parseInt(userId);\n            this.userName = userName;\n            this.start = null;\n            this.end = null;\n            this.contextId = contextId;\n            this.timer = 2500;\n            this.file = false;\n            this.formdata = {};\n            this.polling = null;\n\n            $('#submitdate').click(function (e) {\n                e.preventDefault();\n\n                var startDate = $('#startInput').val();\n                var endDate = $('#endInput').val(); console.log(startDate, endDate);\n\n                var completion = this.checkCompletion(startDate, endDate);\n\n\n\n                var icon = $('<img/>');\n                icon.attr('alt', 'loading');\n                icon.attr('title', 'loading');\n                icon.attr('class', 'tool_time_report_icon loader');\n                icon.attr('src', Url.imageUrl('loading', 'tool_time_report'));\n\n                if (!completion) {\n                    return Notification.alert(\n                        Str.get_string('error'),\n                        Str.get_string('error:completiondates', 'tool_time_report')\n                    );\n                }\n\n                var formdata = {\n                    requestorid: this.requestorId,\n                    userid: this.userId,\n                    username: this.userName,\n                    start: $('#startInput').val(),\n                    end: $('#endInput').val(),\n                    contextid: this.contextId\n                };\n                this.formdata = formdata;\n\n                Ajax.call([{\n                    methodname: 'tool_time_report_generate_time_report',\n                    args: { jsonformdata: JSON.stringify(formdata) },\n                    done: function () {\n                        Str.get_string('client:reportgenerating', 'tool_time_report').done(function (str) {\n                            $('#report-area').addClass('alert-warning')\n                                .html(str).prepend(icon);\n                        });\n                        var that = this;\n                        (function foo() {\n                            that.polling = setInterval(pollFile.bind(that), 7500);\n                        })();\n                    }.bind(this),\n                    fail: Notification.exception\n                }]);\n            }.bind(this));\n        };\n\n        GenerateReport.prototype.checkCompletion = function (startDate, endDate) {\n            if (startDate.length == 0 || endDate.length == 0) {\n                return false;\n            }\n            return true;\n        };\n\n        var pollFile = function () {\n            var dlicon = $('<img/>');\n            dlicon.attr('alt', 'download');\n            dlicon.attr('title', 'download');\n            dlicon.attr('class', 'tool_time_report_icon');\n            dlicon.attr('src', Url.imageUrl('download', 'tool_time_report'));\n\n            Ajax.call([{\n                methodname: 'tool_time_report_poll_report_file',\n                args: { jsonformdata: JSON.stringify(this.formdata) },\n                done: function (data) {\n                    if (data.status == true) {\n                        Str.get_string('client:reportdownload', 'tool_time_report').done(function (str) {\n                            var content = $('<a href=\"' + data.path + '\" target=\"_blank\">' + str + '</a>').prepend(dlicon);\n                            $('#report-area').removeClass('alert-warning').addClass('alert-success')\n                                .html(content);\n                        });\n                        clearInterval(this.polling);\n                        return;\n                    }\n                }.bind(this),\n                fail: Notification.exception\n            }]);\n        };\n\n        return {\n            generateReport: function (requestorId, userId, userName, contextId) {\n                return new GenerateReport(requestorId, userId, userName, contextId);\n            }\n        };\n    });\n"],"file":"generate_report.min.js"}