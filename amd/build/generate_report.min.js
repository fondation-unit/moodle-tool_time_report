define ("tool_time_report/generate_report",["jquery","core/ajax","core/notification","core/str","core/url"],function(a,b,c,d,f){'use strict';var g=function(e,g,i,j){this.requestorId=parseInt(e);this.userId=parseInt(g);this.userName=i;this.start=null;this.end=null;this.contextId=j;this.timer=2500;this.file=!1;this.formdata={};this.polling=null;a("#submitdate").click(function(g){g.preventDefault();var e=document.querySelector("#startInput").valueAsNumber,i=document.querySelector("#endInput").valueAsNumber;console.log(e,i);var j=this.checkCompletion(e,i),k=a("<img/>");k.attr("alt","loading");k.attr("title","loading");k.attr("class","tool_time_report_icon loader");k.attr("src",f.imageUrl("loading","tool_time_report"));if(!j){return c.alert(d.get_string("error"),d.get_string("error:completiondates","tool_time_report"))}var l={requestorid:this.requestorId,userid:this.userId,username:this.userName,start:e,end:i,contextid:this.contextId};this.formdata=l;b.call([{methodname:"tool_time_report_generate_time_report",args:{jsonformdata:JSON.stringify(l)},done:function(){d.get_string("client:reportgenerating","tool_time_report").done(function(b){a("#report-area").addClass("alert-warning").html(b).prepend(k)});var b=this;(function(){b.polling=setInterval(h.bind(b),7500)})()}.bind(this),fail:c.exception}])}.bind(this))};g.prototype.checkCompletion=function(a,b){if(0==a.length||0==b.length){return!1}return!0};var h=function(){var e=a("<img/>");e.attr("alt","download");e.attr("title","download");e.attr("class","tool_time_report_icon");e.attr("src",f.imageUrl("download","tool_time_report"));b.call([{methodname:"tool_time_report_poll_report_file",args:{jsonformdata:JSON.stringify(this.formdata)},done:function(b){if(!0==b.status){d.get_string("client:reportdownload","tool_time_report").done(function(c){var d=a("<a href=\""+b.path+"\" target=\"_blank\">"+c+"</a>").prepend(e);a("#report-area").removeClass("alert-warning").addClass("alert-success").html(d)});clearInterval(this.polling)}}.bind(this),fail:c.exception}])};return{generateReport:function generateReport(a,b,c,d){return new g(a,b,c,d)}}});
//# sourceMappingURL=generate_report.min.js.map
